\documentclass[12pt]{book}
\usepackage{listings}
\usepackage{xspace}
\usepackage{url,color,hyperref}
\usepackage{geometry,graphicx}

\title{Simol developer's guide}
\author{C\'edric DOUCET}
\date{\today}

\newcommand{\CMake}{\texttt{CMake}\xspace} 
\newcommand{\CMakeLists}{\texttt{CMakeLists}\xspace} 
\newcommand{\Git}{\texttt{Git}\xspace} 
\newcommand{\Linux}{\texttt{Linux}\xspace} 
\newcommand{\Make}{\texttt{Make}\xspace}
\newcommand{\Netbeans}{\texttt{Netbeans}\xspace} 
\newcommand{\Simol}{\texttt{Simol}\xspace} 
\newcommand{\SourceSup}{\texttt{SourceSup}\xspace} 



\newcommand{\urlGit}{\href{https://git-scm.com}{https://git-scm.com}}
\newcommand{\urlSourceSup}{\href{https://sourcesup.renater.fr}{https://sourcesup.renater.fr}}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}

\lstset{ %
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=single,                    % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  language=Octave,                 % the language of the code
  otherkeywords={*,...},            % if you want to add more keywords to the set
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2,                       % sets default tabsize to 2 spaces
  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}


\geometry{left=15mm, right=15mm}

\sloppy

\begin{document}

\maketitle
\tableofcontents



\chapter{Getting started}


\section{Prerequisites}

The sources of \Simol are stored on a server of the \SourceSup forge. To be able to get them, you will need to fulfill the following requirements:
\begin{itemize}
\item \textit{having a HTTP/HTTPS access to the web} to be able to get the sources and let \Simol download and install all needed external libraries for you; 
\item \textit{having an account on \SourceSup}, where the sources of \Simol are stored;
\item \Git must be installed on your machine,
\item you must have an account on \SourceSup,
\item you must be able to access the server of \SourceSup with the SSH protocol,
\item you must be a member of the \Simol development team.
\end{itemize}
This section explains how to satisfy these conditions.

\subsection{Having an HTTP/HTTPS access to the web}

If you do not use any proxy to connect the internet, you can skip this step. If you try to download and install the development version of \Simol behind a proxy, you have to define the environment variables named \texttt{http\_proxy} and \texttt{https\_proxy}. These variables are required to download external libraries of \Simol. For example, let us assume that your proxy identifier is \texttt{proxy.enpc.fr} with port 3128. To define \texttt{http\_proxy}, you need to type the following line in your terminal:

\lstset{language=bash} 
\begin{lstlisting}
export http_proxy=http://proxy.enpc.fr:3128
export https_proxy=https://proxy.enpc.fr:3128
\end{lstlisting}
Note that the scope of these variables is limited to the current terminal. If you want them to be defined each time you open a new terminal, you need to add theses lines at the end of your \url{~/.bashrc} file.

\subsection{Having an SSH access to \SourceSup}


\subsection{Having an account on \SourceSup}

Sources of \Simol are stored on a software forge called \SourceSup, which you can connect to at \urlSourceSup.  

The sources of \Simol can only be accessed through the SSH protocol. To be able to use this protocol, you need to have a private key and a public key. These keys are usually located at \url{~/.ssh} in your machine. If you have already defined a key called \textit{mykey}, you should see the two files \url{mykey} and \url{mykey.pub} in this directory. The former is private and should never be communicated to anyone else. The latter is public and must be uploaded on \SourceSup. 

If you do not have any SSH pair of keys, you need to create one. To do it, just type
\lstset{language=bash} 
\begin{lstlisting}
ssh keygen -t dsa
\end{lstlisting}
in a terminal.

\subsection{Being a member of the \Simol team}






\subsection{Having \Git installed}


\Git is a popular version control system which has been written by Linus Thorvald, the creator of \Linux. The best way to learn more about \Git is to visit its official website: \urlGit. Please refer to the official documentation to find the installation steps for you own machine. In most cases, the easiest way to install it is to use a package manager like \texttt{apt-get}, \texttt{yum}, \texttt{homebrew}, etc. For example, you can install \Git on Ubuntu systems by simply typing
\lstset{language=bash} 
\begin{lstlisting}
sudo apt-get install git
\end{lstlisting}
in a terminal. You can check that \Git is installed on your machine with the command
\lstset{language=bash} 
\begin{lstlisting}
git --version
\end{lstlisting}
which should return something like this:
\begin{lstlisting}
git version 1.7.9.5
\end{lstlisting}





that the default name \textit{simol} has been keeped.

\section{Installation of \Simol}

\subsection{Downloading the sources}

To clone the source repository of \Simol, you need to be located in the directory where you want to store the development version of the software. Then, you have to type
\lstset{language=bash} 
\begin{lstlisting}
git clone git+ssh://git@git.renater.fr:2222/simol.git
\end{lstlisting}
in a terminal. This will create a directory \url{simol} and copy the sources of \Simol in it. 

\paragraph{Note:}
it is possible to change the name of the cloning directory, say \textit{foo}, by typing 
\lstset{language=bash} 
\begin{lstlisting}
git clone git+ssh://git@git.renater.fr:2222/simol.git foo
\end{lstlisting}
In this documentation, we always assume 



\subsection{Configuration}

Sources of \Simol are built in a subdirectory called \url{build}. To reach it, just type
\lstset{language=bash} 
\begin{lstlisting}
cd simol/build
\end{lstlisting}
in a terminal. Then, the installation of \Simol is very simple:
\lstset{language=bash} 
\begin{lstlisting}
cmake ..
make
make install
\end{lstlisting}

\subsection{Building}



\subsection{Netbeans (8.0.2)}

You may want to use an integrated development environment (IDE) to contribute to \Simol. Many IDEs are available but only a few are able to handle a configuration script from \CMake. \Netbeans is one of them. To link \Netbeans with \Simol, please follow these steps:
\begin{enumerate}
\item run \Netbeans
\item if a project is already open, choose \textit{Close all projects} in \textit{File} menu
\item in \textit{File} menu, choose \textit{New project} and then choose \textit{C/C++ project with existing sources}
\item specify the directory containing \Simol sources and choose \textit{Custom} as the configuration mode
\item choose \textit{Run configure script in subfolder} and modify \textit{Configure arguments} by specifiying your own C/C++/Fortran compilers and enabling automatic downloading of third-party libraries. The result should look like mine:
\lstset{language=bash} 
\begin{lstlisting}
-G "Unix Makefiles" 
-DCMAKE_BUILD_TYPE=Debug 
-DCMAKE_C_COMPILER=/usr/local/bibliotheques/gcc/4.9.2/bin/gcc 
-DCMAKE_CXX_COMPILER=/usr/local/bibliotheques/gcc/4.9.2/bin/g++ 
-DCMAKE_Fortran_COMPILER=/usr/local/bibliotheques/gcc/4.9.2/bin/gfortran 
-DENABLE_DOWNLOAD=True 
-DCMAKE_C_FLAGS_DEBUG="-g3 -gdwarf-2" 
-DCMAKE_CXX_FLAGS_DEBUG="-g3 -gdwarf-2" 
-DCMAKE_EXPORT_COMPILE_COMMANDS=ON
\end{lstlisting}
\item skip other steps until the end of the creation of the project
\end{enumerate}

\section{Running first examples}

\subsection{Molecular dynamics}

\subsection{Quantum chemistry}


\chapter{Installation}


\section{Compilers}

\subsection{GCC 4.9.3}

The GNU Compilation Collection (GCC) is the preferred set of compilers for Simol. If needed, we recommend to install the 4.9.3 version of this collection. There are two reasons for this:
\begin{itemize}
\item this version supports C++11 features,
\item strings are not defined the same starting from version 5 and it causes many compilation problems which we have not solved yet.
\end{itemize}
However, any version number between 4.8.1 and 4.9.3 fulfills these conditions. For example, if the number version returned by the command line
\lstset{language=bash} 
\begin{lstlisting}
g++ --version
\end{lstlisting}
is at least 4.8.1, you do not need to install any other version of GCC and you can skip this step. Especially, even if the version number is 5.1.0 or higher, it would be possible to compile and link simol files without any problems (not tested). The sequel is only useful if you need to install GCC 4.9.3 manually. 

The installation of GCC 4.9.3 is quite simple. We describe here how it may be installed from sources. Alternative approaches are possible, especially those based on a package manager. However, package managers differ significatively from an operating system to another, as well as cross-plateform tools. That is the reason why we do not plan to give any support for them here. Please refer to the documentation of your favorite tool if you do not want to install GCC from sources, but from a package manager. To install GCC 4.9.3 from sources, please download the source from a mirror site on the official website 
\begin{center}
	\url{https://gcc.gnu.org/gcc-4.9}
\end{center}
For example, you can download and exract the sources thanks to the following command lines:
\lstset{language=bash} 
\begin{lstlisting}
	wget ftp://ftp.uvsq.fr/pub/gcc/releases/gcc-4.9.3/gcc-4.9.3.tar.gz
	tar xf gcc-4.9.3.tar.gz
\end{lstlisting}
It will create a directory named gcc-4.9.3. Then, change to this directory and download prerequisites:
\begin{lstlisting}
	cd gcc-4.9.3
	./contrib/download_prerequisites
\end{lstlisting}
It will take some time to achieve the downloading process. Once it is done, source must be built outside of the source directory. Let $GCC\_ROOT$ be the directory where you want to install GCC 4.9.3. For example, you can define it like this:
\begin{lstlisting}
	export GCC_ROOT=/home/yourlogin/gcc/4.9.3
\end{lstlisting}
where \textit{youlogin} stands for your own login. The installation process is defined by these steps:
\begin{lstlisting}
	cd ..
	mkdir build-gcc-4.9.3
	cd gcc-4.9.3
	../gcc-4.9.3/configure --prefix=$GCC_ROOT --enable-languages=c,c++,fortran
	make -j 4
	make install
\end{lstlisting}




\subsection{Other compilers}

We do not provide any support for other compilers for the moment.



\chapter{Development environment}

\section{File organization}
\section{Build system}

\subsection{Why \CMake?}

The build system of \Simol is \CMake, which is very similar to \Make. A typical installation of a software with \CMake consists in running the three following commands from a subdirectory usually called \url{build}: 
\lstset{language=bash} 
\begin{lstlisting}
cmake src && make && make install
\end{lstlisting}
If you have already installed a software with \Make, you probably noticed the similarity with the classical combo:
\lstset{language=bash} 
\begin{lstlisting}
src/configure && make && make install
\end{lstlisting}
The only difference between \Make and \CMake is the first command, which corresponds to the configuration step. This is one of the reason why \CMake has been chosen to automatize the installation of \Simol. The second reason is that \CMake is a cross-platform build system. Contrary to \Make, which is only available on Unix systems, \CMake can be used on Windows systems too.

\subsection{How does it work?}

\CMake relies on a hierarchy of configuration files named \CMakeLists. The main configuration file must be located at the top directory of the project.







\section{Version control wit \Git}


\subsection{Main commands}


\subsubsection{Clone}

\subsubsection{Add}

\subsubsection{Commit}


\subsubsection{Push}


\subsubsection{Status}


\subsubsection{Pull}


\subsection{Good practices}


\subsubsection{Atomic commits}

\subsubsection{Writing good commit messages}



\section{Coding rules}
\section{Unit tests}
\section{Continuous integration}
\section{Documentation}


\chapter{FAQ}

\section{Error messages}


\subsection{The compiler (...) does not support -std=c++11 flag.}

\Simol relies on some features of the 2011 norm of C++ but your compiler does not seem to support this norm. You need to provide another compiler by passing to the \texttt{cmake} command a correct value of the \texttt{CMAKE\_CXX\_COMPILER} variable. For example, the very first version of \texttt{GCC} which supports the C++11 norm is 4.8.1. If you have installed this version in \url{/usr/local/gcc/4.8.1}, you need to type
\lstset{language=bash} 
\begin{lstlisting}
cmake -D CMAKE_CXX_COMPILER=/usr/local/gcc/4.8.1/bin/g++
\end{lstlisting}
during the compilation step.

\subsection{Cloning into 'simol'... Permission denied (publickey)}

This message means that something goes wrong when you try to connect \SourceSup with you SSH key. You should verify that your key is effectively activated with the command
\lstset{language=bash} 
\begin{lstlisting}
ssh-add -l
\end{lstlisting}
If you obtain something like this:
\lstset{language=bash} 
\begin{lstlisting}
The agent has no identities
\end{lstlisting}
then your key is not activated. To activate it, you have to type add your key:
\lstset{language=bash} 
\begin{lstlisting}
ssh-add mykey
\end{lstlisting}
where \textit{mykey} is the full name of your key (including its path).


\end{document}
